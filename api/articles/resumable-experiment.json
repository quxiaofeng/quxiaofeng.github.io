{"title":"Resumable Experiment","slug":"resumable-experiment","date":"2014-03-12T08:38:49.000Z","updated":"2018-04-21T08:18:25.482Z","comments":true,"path":"api/articles/resumable-experiment.json","photos":[],"link":"","excerpt":"初衷用 matlab 实现可恢复的批量实验由于学术研究（攒paper）需要，经常需要针对许多参数进行枚举优化。尤其在一些比较大的数据集上，做多个参数的枚举扫描优化的时候，运行速度慢，实验进行时间长。所以想设计一种这样的批量进行实验的程序。在批量进行参数扫描时，为每一次单独实验生成一组参数，调用这组参数进行实验，记录参数和实验结果。完成一个实验之后，自动进行下一个实验。如果一个实验由于意外、或者人工中断，没有完成，再次打开 matlab 进行实验时，可以接着上次的实验继续进行。如果实验出现意外，出错了，可以记录出错，不退出，自动进行下一个实验。","covers":null,"content":"<h2 id=\"初衷\"><a href=\"#初衷\" class=\"headerlink\" title=\"初衷\"></a>初衷</h2><p><strong>用 matlab 实现可恢复的批量实验</strong></p>\n<p>由于学术研究（攒paper）需要，经常需要针对许多参数进行枚举优化。尤其在一些比较大的数据集上，做多个参数的枚举扫描优化的时候，运行速度慢，实验进行时间长。所以想设计一种这样的批量进行实验的程序。</p>\n<ol>\n<li>在批量进行参数扫描时，为每一次单独实验生成一组参数，调用这组参数进行实验，记录参数和实验结果。</li>\n<li>完成一个实验之后，自动进行下一个实验。</li>\n<li>如果一个实验由于意外、或者人工中断，没有完成，再次打开 matlab 进行实验时，可以接着上次的实验继续进行。</li>\n<li>如果实验出现意外，出错了，可以记录出错，不退出，自动进行下一个实验。</li>\n</ol>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"进展\"><a href=\"#进展\" class=\"headerlink\" title=\"进展\"></a>进展</h2><p>详见代码在 GitHub 上的 repo。</p>\n<p><a href=\"https://github.com/quxiaofeng/balance/tree/master/ResumableExperiment\" target=\"_blank\" rel=\"noopener\">balance/ResumableExperiment at master · quxiaofeng/balance · GitHub</a></p>\n<h3 id=\"基本想法\"><a href=\"#基本想法\" class=\"headerlink\" title=\"基本想法\"></a>基本想法</h3><p>基本想法是，先把参数排列组合成参数组的集合，把进度保留在一个mat文件里面。每次开始批量之前检查是否有当前批量的进度记录，如果有记录，载入进度记录继，使用当前进度的参数组进行一次实验，记录结果并继续；如果没有记录，创建进度记录文件，记录进度，进行实验。</p>\n<h3 id=\"意外\"><a href=\"#意外\" class=\"headerlink\" title=\"意外\"></a>意外</h3><p>在自己造轮子的时候，我记得有一次半夜在网上看到类似功能的代码/函数/工具箱，可以直接保存实验运行时状态，稍后再载入的。当时没有保存下来，隔天清醒之后就忘了。</p>\n<p>暂时找不到了，再投入精力去也没有什么意义，不如继续已有的工作。</p>\n<h2 id=\"TODO-要进行的工作\"><a href=\"#TODO-要进行的工作\" class=\"headerlink\" title=\"TODO - 要进行的工作\"></a>TODO - 要进行的工作</h2><ol>\n<li><del>修改重订函数名。修改程度较大，不考虑前向兼容。</del></li>\n<li>编写unittest</li>\n<li><del>传递环境变量到每个参数集中。</del></li>\n<li><del>保存每一次实验的结果到 excel</del>。</li>\n<li><del>当参数小于等于两个时，保存到一个excel。</del></li>\n<li><del>当参数大于两个时，其他参数及其取值以excel文件名的形式保存。</del></li>\n<li><del>整理所有函数到一个函数，保存到一个文件中。</del></li>\n<li><del>写一个example。</del></li>\n<li>将参数组合的解析用函数指针实现。现在为了使用resumable，还需要修改原始函数，接收参数组合之后解析各个参数。</li>\n<li>拆分 resumable 和 excel saving 代码。现有的 resumable 是跟 excel 结果保存程序结合的。</li>\n<li><del><strong>BUG</strong> 当程序被中断，并退出matlab，然后再次打开matlab，应用程序的时候，前些次实验的结果没能保留下来。（只要不退出 matlab，结果还存在。）<strong>分析</strong> 主要原因是结果作为全局函数，每次保存结果时，都会保存到当前实验目录下。但如果退出matlab，以前的实验结果就不见了。<strong>解决方案</strong> 当前比较简单的方法是把结果数据跟进度progress一起保存。</del></li>\n<li><del>环境变量现在是用手动增加的方法保存，可以保存为一个结构或用一个函数指针，这样可以支持多一些变量。</del></li>\n</ol>\n","categories":[{"name":"coding","slug":"coding","count":26,"path":"api/categories/coding.json"}],"tags":[{"name":"research","slug":"research","count":8,"path":"api/tags/research.json"},{"name":"matlab","slug":"matlab","count":5,"path":"api/tags/matlab.json"}]}